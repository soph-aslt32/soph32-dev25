# memo

InventoryOptimization/InventoryContorol について考えるワークスペースです．

## シーケンス検討

```py
for day in simulation_days:
    generate_orders(day)                   # 受注生成
    update_designs(day)                   # 設計業務の進捗
    check_and_order_parts(day)            # 設計完了分に対して部品発注
    receive_parts(day)                    # 部品の納品チェック
    schedule_assembly(day)                # 組立スケジューリング
    proceed_inspection_and_shipping(day)  # 検査・出荷準備・出荷
    update_inventory_and_resources(day)   # 在庫とエリアの状態更新
    collect_metrics(day)                  # KPIの記録
```

## KPI

📈 評価指標（KPI）
出荷遅延件数 / 平均遅延日数

組立までの平均待ち時間（設計完了→組立）

在庫回転率

過剰在庫・欠品の発生頻度

組立・検査エリアの使用率

## ChatGPTの回答

```txt
部品の予測アルゴリズム設計について詳細化したいところですが，過去の受注履歴等から得られる情報だけでは完全に予測するのが難しいと思われる要件で，悩んでいます．
具体的には，
・工場外の情報が関係する（為替，情勢，物価高等）
・過去の製品と一部似ているが，完全に新規の製品の受注も入る

なので，機械学習や深層学習的アプローチもあれば歓迎ですが，単純な先行発注手法や古典的なアルゴリズムも受け付けています．
```

非常に現実的かつ重要な観点を押さえられています。ご指摘のとおり、「製品ごとに必要な部品が異なる」「一部は新規設計」「外的要因（為替・物価など）も影響する」――という状況では、**完全な予測は不可能**であるという前提のもとで、\*\*「不確実性をどう扱うか」\*\*が鍵になります。

ここでは、3つのレベル（古典的 → 統計的 → 機械学習的）に分けて、部品需要予測アプローチをご提案します。

---

## 🔹レベル1：古典的・ルールベースアプローチ（先行発注）

### 1. **安全在庫戦略（Safety Stock）**

* 発注リードタイム中の需要のばらつきをカバーするために、一定の安全在庫を持つ。
* 安全在庫量の例：

  ```text
  安全在庫 = Z × σD × √L
  ```

  * Z: サービスレベル（95%であればZ=1.645など）
  * σD: 日ごとの需要の標準偏差
  * L: リードタイム（日数）

### 2. **定量発注方式（EOQ）**

* 在庫が一定以下（発注点）になったら定量（例：100個）発注
* 予測ではなく、消費スピードとコスト最小化のバランスを取る

---

## 🔹レベル2：統計モデルによる需要予測

### 1. **移動平均／指数平滑法（Simple/Exponential Smoothing）**

* 最近の需要傾向をもとに、近未来の部品需要を予測
* 新規製品には使えないが、\*\*定型部品（例：ネジ、汎用センサー）\*\*の予測には有効

### 2. **カテゴリ別予測（クラスベース）**

* 製品カテゴリ（形状、大きさ、用途）ごとに、過去の設計から「よく使う部品リスト」を作成
* 新規製品がどのカテゴリに属すかを分類すれば、おおよその必要部品を予測できる
* 例：「医療機器系」製品は高確率で特定ICが必要

---

## 🔹レベル3：機械学習・深層学習アプローチ

### 1. **部品需要分類モデル（マルチラベル分類）**

* 過去の受注データ（製品属性、設計仕様）を用いて、必要部品を「確率的に推定」
* モデル例：

  * ランダムフォレスト（軽量・解釈性あり）
  * LightGBM / CatBoost（カテゴリ変数に強い）
  * Transformerベース（製品仕様がテキスト記述の場合）

### 2. **時系列外部変数付き予測（外部要因の統合）**

* 入力特徴量に以下を加える：

  * 為替レート（USD/JPY等）
  * 原材料価格（銅、半導体等）
  * 輸送遅延指数（海運の混雑度など）
* 予測モデル：

  * 多変量時系列（VAR, Prophet）
  * RNN/LSTM（連続的な時系列を予測）
  * Temporal Fusion Transformer（不確実性付き予測にも対応）

### 3. **類似製品検索（類推ベース予測）**

* 新規受注製品が過去製品と部分的に似ているなら：

  * 過去の製品と部品の関係を**ベクトル化**
  * 新規受注に近い類似品を検索して、その部品構成を参考に予測
  * モデル：製品属性をベクトル化するEncoder＋k-NN

---

## ✅ 予測戦略の組み合わせ提案

| 部品の種類            | アプローチ例            |
| ---------------- | ----------------- |
| 汎用品（ネジ、筐体など）     | 定量発注＋指数平滑法        |
| 準定型部品（モーター、基板など） | クラスタ分類＋過去傾向予測     |
| 高度な部品（特殊センサー等）   | 設計仕様ベースの類似検索、AI予測 |
| リスクの高い部品         | 安全在庫＋外部指標連動発注     |

---

## 🔄 シミュレーションとの統合方法

* 部品予測は「設計完了前」に推定されることを想定し、確率付きで「先行発注候補」として使う。
* 予測結果に応じて、シミュレーション上で：

  * 予測通り→納期短縮
  * 外れ→余剰在庫 or 欠品発生

これにより、「予測精度」→「リードタイム最適化効果」や「在庫コスト」に直結する形で評価可能です。

---

ご希望があれば、特定のアプローチ（例：ランダムフォレストによるマルチラベル予測や、カテゴリ分類＋ルールベース発注）について、**具体的な実装テンプレートやシミュレーション統合のコード例**も提供できます。どう進めましょうか？
